<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<title>Study 페이지</title>
<link rel="stylesheet" href="css/bootstrap.slate.css"/>
<link rel="stylesheet" href="css/custom.css"/>

<style>
	.commentArea {
		font: 14px Arial;
		padding: 0 10px;
		margin-top: 20px;  
		background-color: #eee;
		height: 400px;  
		overflow-x: auto;
		border-radius: 10px 10px 0px 0px;
	}
	.overwrap{
		position: absolute;
		width: 100%;
		height: 520px;
		top:0;
		left:0;
		background-color: #ccc;
		border-radius: 10px;
	}
	.bubbledLeft,.bubbledRight {
	    margin-top: 10px;
	    margin-bottom: 10px;
	    padding: 5px 9px;
	    max-width: 50%;
	    clear: both;
	    position: relative;
	    font-weight: bold;
	}

	.bubbledLeft{
	    float: left;
	    margin-right: auto;
	    -webkit-border-radius: 8px 8px 8px 0px;
	    -moz-border-radius: 8px 8px 8px 0px;
	    -o-border-radius: 8px 8px 8px 0px;
	    -ms-border-radius: 8px 8px 8px 0px;
	    border-radius: 8px 8px 8px 0px;
	    background-color: #65B045;
	    color: #ffffff;
	}

	.bubbledLeft:before {
	    border-bottom: 10px solid #65B045;
	    border-left: 9px solid rgba(0, 0, 0, 0);
	    position: absolute;
	    bottom: 0;
	    left: -8px;
	    content: "";
	}

	.bubbledRight{
	    float: right;
	    margin-left: auto;
	    text-align: right;
	    -webkit-border-radius: 8px 8px 0px 8px;
	    -moz-border-radius: 8px 8px 0px 8px;
	    -o-border-radius: 8px 8px 0px 8px;
	    -ms-border-radius: 8px 8px 0px 8px;
	    border-radius: 8px 8px 0px 8px;
	    background-color: #07D;
	    color: white;
	}

	.bubbledRight:before {
	    border-bottom: 9px solid #07D;
	    border-right: 9px solid rgba(0, 0, 0, 0);
	    position: absolute;
	    bottom: 0;
	    right: -8px;
	    content: "";
	}	
	#msgControl{
		display: none;
	}	
	.commentArea .text-center{
		font-size: 12px;
		font-weight: bold;
		font-style: italic;
	}
</style>
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
<![endif]-->
<script src="js/jquery-1.11.2.js"></script>
<script src="js/bootstrap.js"></script>
<script type="text/javascript" src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="js/underscore.js"></script>
<script type="text/javascript" src="js/controlv.js"></script>
</head>
<body>
<div id="wrap">
<div class="navbar navbar-inverse navbar-fixed-top">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="http://acornacademy.co.kr/">Acorn Academy</a>
			<button type="button" class="navbar-toggle"
				data-toggle="collapse"
				data-target=".navbar-collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
		</div>
		<div class="navbar-collapse collapse">
			<ul class="nav navbar-nav">
	            <li><a href="/">Home</a></li>
	            <li class="active"><a href="student.html">Study</a></li>
	            <li><a href="slide.html">Slide Share</a></li>
	        </ul>
		</div>
	</div>
</div>
<div class="container">
	<!-- Tab 메뉴 -->
	<ul class="nav nav-tabs" id="myTab">
	  	<li class="active">
	  		<a id="clipTab" href="#ClipBoard" data-toggle="tab">ClipBoard <span id="clipBadge" class="badge"></span></a>
	  	</li>
	  	<li>
	  		<a id="fileTab" href="#FileList" data-toggle="tab">FileList <span id="fileBadge" class="badge"></span></a>
	  	</li>
	  	<li>
	  		<a id="chattingTab" href="#chatting" data-toggle="tab">Chatting <span id="chattingBadge" class="badge"></span></a>
	  	</li>
	</ul>
	<!-- Tab 컨텐츠 -->
	<div class="tab-content">
		<!-- code Provider -->
		<div class="tab-pane active" id="ClipBoard">
			<br/>	
			<form class="form-horizontal" role="form">
				<label for="fontSize" class="col-xs-2">Font-Size</label>
				<div class="col-xs-1">
					<select id="fontSize" class="selectpicker">
						<option>12</option>
						<option>13</option>
						<option selected="selected">14</option>
						<option>15</option>
						<option>16</option>
						<option>17</option>
						<option>18</option>
						<option>19</option>
						<option>20</option>
					</select>	
				</div>	
			</form>
			<div class="clearfix"></div>	
<pre class="prettyprint well" style="height:400px;overflow:auto;font-size:14px;background-color:white">
</pre>
			<div class="row text-center">
				<div class="btn-group">
					<button onclick="before()" class="btn btn-default" id="before">
						<span class="glyphicon glyphicon-chevron-left"></span>
					</button>
					<button class="btn btn-default"><strong id="pageSpan">0</strong></button>
					<button onclick="after()" class="btn btn-default" id="after">
						<span class="glyphicon glyphicon-chevron-right"></span>
					</button>
				</div>
			</div>
			<br/>		
			<div class="row">
				<div class="col-xs-3">
					<button class="btn btn-primary btn-block" id="copyBtn" title="클립보드로 복사">
						 <span>Copy</span>
					</button>
				</div>
				<div class="col-xs-3">
					<button class="btn btn-warning btn-block" onclick="clearScreen()"><span class="glyphicon glyphicon-remove"></span> <span class="hidden-xs">Clear</span></button>
				</div>
				<div class="col-xs-3">
					<button class="btn btn-success btn-block" onclick="getCurrentCode()"><span class="glyphicon glyphicon-repeat"></span> <span class="hidden-xs">Reload</span></button>
				</div>
				<div class="col-xs-3">
					<button class="btn btn-danger btn-block" onclick="deleteHistory()"><span class="glyphicon glyphicon-trash"></span> <span class="hidden-xs">RemoveAll</span></button>
				</div>
			</div>
			<!--<button id="copyBtn">Copy!</button>-->
		</div>
		<!-- 업록드 파일 목록 -->
		<div class="tab-pane" id="FileList">
			<div class="row">
				<div class="col-xs-12">
		  			<table class="table table-striped ">
		  				<thead>
		  					<tr>
		  						<th>파일아이디</th>
		  						<th>파일명</th>
		  						<th>설명</th>
		  					</tr>
		  				</thead>
		  				<tbody id="fileBody">
		  					
		  				</tbody>
		  			</table>					
				</div>
			</div>
		</div>
		<!-- 쳇팅 창-->
		<div class="tab-pane" id="chatting">
			<div class="row">
				<div class="col-sm-6">
					<div class="commentArea">
						<div class="overwrap">
							<div class="input-group">
							    <input id="chatName" type="text" class="form-control" placeholder="대화명 입력..."/>
							    <span class="input-group-btn">
							        <button id="enterBtn" class="btn btn-default" type="button">Enter</button>
							    </span>
    						</div><!-- /input-group -->
						</div>
					</div>	
				</div>
			</div>
			<div class="row" id="msgControl">
				<div class="col-sm-6">
					<div class="input-group">
						<input id="inputMsg" type="text" class="form-control" placeholder="메세지 입력..."/>
					    <span class="input-group-btn">
					        <button id="sendBtn" class="btn btn-default" type="button">Send</button>
					    </span>
    				</div><!-- /input-group -->
				</div>
			</div>
		</div><!-- #chatting -->	
	</div><!-- .tab-content -->
</div> <!-- .container -->

<!-- 모달 다이얼로그 -->
<div id="confirmModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			    <h3>알림</h3>
			  </div>
			  <div class="modal-body">
			    <p id="confirmMsg">One fine body…</p>
			  </div>
			  <div class="modal-footer">
			    <a href="#" class="btn btn-success" data-dismiss="modal">아니요</a>
			  	<button class="btn btn-danger" data-dismiss="modal" onclick="clearHistory()" >네</button>
			  </div>
		</div>	
	</div>	
</div>

<!-- 모달 다이얼로그 -->
<div id="linkModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			  <div class="modal-header">
			    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			    <h3>링크를 클릭하세요</h3>
			  </div>
			  <div class="modal-body">
			    <a href="" id="modalLink" target="_blank"></a>
			  </div>
			  <div class="modal-footer">
			    <a href="#" class="btn btn-success" data-dismiss="modal">취소</a>
			  </div>
		</div>	
	</div>	
</div>

</div><!-- / #wrap -->
<div id="footer">
  <div class="container">
  	<br/>
    <p class="text-muted credit"><a style="color:#272b30;font-weight:bold" href="http://acornacademy.co.kr/">HBI 기술연구소 교육센터</a></p>
  </div>
</div>
<script>

	//대화명 
	var chatName;
	var newMessageCount=0;
	var isChatting=false;
	var thisDate, postDate;

	$("#chattingTab").click(function(){
		isChatting=true;
		$("#chattingBadge").text("");
		newMessageCount=0;
	});

	$("#clipTab, #fileTab").click(function(){
		isChatting=false;
	});

	//대화방 입장 버튼을 눌렀을때 
	$("#enterBtn").click(function(){
		newPerson();
	});
	//대화방 입장 버튼을 누르기 않고 엔터키를 눌렀을때  
	$("#chatName").keydown(function(event){
		if(event.keyCode==13){
			newPerson();
		}
	});
	//새로운 참여자 입장 처리 
	function newPerson(){
		$(".overwrap").hide();
		$("#msgControl").show();
		chatName=$("#chatName").val();
		if(chatName=="" || chatName==undefined){
			chatName="익명의 참여자";
		}
		socket.emit("newPerson", chatName);
	};

	//전송 버튼을 눌렀을때
	$("#sendBtn").click(function(){
		sendMessage();
	});
	//대화 전송 버튼을 누르지 않고 엔터키를 눌렀을때 
	$("#inputMsg").keydown(function(event){
		if(event.keyCode==13){
			sendMessage();
		}
	});
	//새로운 대화 전송 처리 
	function sendMessage(){
		var msg=$("#inputMsg").val();
		$("#inputMsg").val("").focus();
		var obj={};
		obj.chatName=chatName;
		obj.msg=msg;
		//새메세지 전송하고
		socket.emit("newMessage", obj);
		$("<div class='text-center text-danger'>")
		.text(getTimeText())
		.appendTo(".commentArea");
		//대화창에 내 메세지 표시 
		$("<div class='bubbledRight'></div>")
		.text(chatName+" : "+msg)
		.appendTo(".commentArea");
		addClear();
		$(".commentArea").scrollTop(999999999);	
	}
	//새로운 메세지 도착 
	socket.on("newMessage", function(data){
		if(chatName == undefined)return;
		var name=data.chatName;
		var msg=data.msg;
		var $span=$("<span class='badge'/>").text(name);
		var $span2=$("<span class='text-danger'/>").text(" "+getTimeText());
		$("<div class='text-center'/>")
		.append($span)
		.append($span2)
		.appendTo(".commentArea");
		$("<div class='bubbledLeft'/>")
		.text(msg)
		.appendTo(".commentArea");
		addClear();
		$(".commentArea").scrollTop(999999999);
		if(!isChatting){
			newMessageCount++;
			$("#chattingBadge").text(newMessageCount);
			$("#chattingTab").popover("destroy");
			setTimeout(function(){
				$("#chattingTab").popover({
					title:name,
					content:msg,
					placement:"top",
					trigger:"manual"
				}).popover("show");
				setTimeout(function(){
					$("#chattingTab").popover("destroy");
				}, 3000);
			}, 200);
		}
	});
	//새로운 참여자 정보 도착 
	socket.on("newPerson", function(data){
		if(chatName == undefined)return;
		$("<div class='text-center text-danger'>")
		.text(getTimeText())
		.appendTo(".commentArea");

		$("<div class='bubbledRight'/>")
		.text(data+" 님이 입장했습니다.")
		.appendTo(".commentArea");
		addClear();
		$(".commentArea").scrollTop(999999999);	
	});

	function getTimeText(){
		var date=new Date();
		var hour=date.getHours();
		var min=date.getMinutes();
		var str=hour+"시 "+min+"분 ";
		return str;
	};

	function addClear(){
		$("<div class='clearfix'/>").appendTo(".commentArea");
	};
</script>
</body>	
</html>